p8105_hw2_zg2486
================
2024-09-27

# Problem 1

1.  Read and clean the data, select and convert variables.

``` r
subway_df = 
  read_csv(
    "./NYC_Transit_Subway_Entrance_And_Exit_Data.csv", 
    na = c("NA", "", "."), show_col_types = FALSE) %>% 
  janitor::clean_names() %>% 
  select(line:entry, vending, ada) %>% 
  mutate(
    entry = case_match(
      entry,
     "YES" ~ TRUE,
     "NO" ~ FALSE)
    ) 
```

Variables included in this dataset are: `line`, `station name`,
`station latitude`, `station longitude`, `served routes (route 1 - 11)`,
`entry`, `vending`, `entrance type`, and `ADA compliance`. I used
`janitor::clean_names` to clean up column names of data after importing
data file with specifying missing values, then retained `19` required
variables by `select` function, lastly, converted entry variable from
character to logical variable by `mutate(case_match)` function. There
are `1,868` rows and `19` columns.These data are not tidy yet.

2.  Answer 3 questions.

``` r
distinct_station = group_by(subway_df, station_name) %>% 
  distinct(line) %>% 
  nrow()


ada_station = filter(subway_df, ada == TRUE) %>% 
  group_by(station_name) %>% 
  distinct(line) %>% 
  nrow()

no_vending = filter(subway_df, vending == "NO") %>% 
  group_by(station_name) %>% 
  distinct(line) %>% 
  nrow()

entrance_allow = filter(subway_df, vending == "NO") %>% 
  filter(entry == TRUE) %>% 
  group_by(station_name) %>% 
  distinct(line) %>% 
  nrow()

proportion_entry = entrance_allow / no_vending
```

There are `465` distinct stations. and `84` stations are ADA
compliant.`43.43%` of station entrances / exits without vending allow
entrance.

3.  Reformat data.

``` r
str(subway_df)
```

    ## tibble [1,868 × 19] (S3: tbl_df/tbl/data.frame)
    ##  $ line             : chr [1:1868] "4 Avenue" "4 Avenue" "4 Avenue" "4 Avenue" ...
    ##  $ station_name     : chr [1:1868] "25th St" "25th St" "36th St" "36th St" ...
    ##  $ station_latitude : num [1:1868] 40.7 40.7 40.7 40.7 40.7 ...
    ##  $ station_longitude: num [1:1868] -74 -74 -74 -74 -74 ...
    ##  $ route1           : chr [1:1868] "R" "R" "N" "N" ...
    ##  $ route2           : chr [1:1868] NA NA "R" "R" ...
    ##  $ route3           : chr [1:1868] NA NA NA NA ...
    ##  $ route4           : chr [1:1868] NA NA NA NA ...
    ##  $ route5           : chr [1:1868] NA NA NA NA ...
    ##  $ route6           : chr [1:1868] NA NA NA NA ...
    ##  $ route7           : chr [1:1868] NA NA NA NA ...
    ##  $ route8           : num [1:1868] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ route9           : num [1:1868] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ route10          : num [1:1868] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ route11          : num [1:1868] NA NA NA NA NA NA NA NA NA NA ...
    ##  $ entrance_type    : chr [1:1868] "Stair" "Stair" "Stair" "Stair" ...
    ##  $ entry            : logi [1:1868] TRUE TRUE TRUE TRUE TRUE TRUE ...
    ##  $ vending          : chr [1:1868] "YES" "YES" "YES" "YES" ...
    ##  $ ada              : logi [1:1868] FALSE FALSE FALSE FALSE FALSE FALSE ...

``` r
reformat_df = subway_df %>%
  mutate(route8 = as.character(route8)) %>% 
  mutate(route9 = as.character(route9)) %>% 
  mutate(route10 = as.character(route10)) %>% 
  mutate(route11 = as.character(route11)) %>% 
  pivot_longer(
    route1:route9,
    names_to = "route_number",
    values_to = "route_name")

a_train = filter(reformat_df, route_name == "A") %>% 
  group_by(station_name) %>% 
  distinct(line) %>% 
  nrow()

ada_a_train = filter(reformat_df, ada == TRUE) %>% 
  filter(route_name == "A") %>% 
  group_by(station_name) %>% 
  distinct(line) %>% 
  nrow()
```

There are 60 distinct stations serve the A train. There are 17 ADA
compliant of the stations that serve the A train.

# Problem 2

``` r
mr_df = 
  read_excel("./202409 Trash Wheel Collection Data.xlsx",
             sheet = "Mr. Trash Wheel", na = c("NA", "", "."),
  ) %>% 
  select(-starts_with("...")) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(year = as.numeric(year)) %>% 
  mutate(sports_balls = as.integer(sports_balls)) %>% 
  mutate(name = "Mr") 

professor_df = 
  read_excel("./202409 Trash Wheel Collection Data.xlsx",
             sheet = "Professor Trash Wheel", na = c("NA", "", ".")
  ) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(name = "Professor")

gwynnda_df = 
  read_excel("./202409 Trash Wheel Collection Data.xlsx",
             sheet = "Gwynnda Trash Wheel", na = c("NA", "", ".")
  ) %>% 
  janitor::clean_names() %>% 
  filter(!is.na(dumpster)) %>% 
  mutate(name = "Gwynnda")

wheel_tidy = 
  bind_rows(mr_df, professor_df, gwynnda_df) %>% 
  janitor::clean_names() %>% 
  relocate(name) 

total_observation = wheel_tidy %>% 
  nrow()

total_weight = 
  wheel_tidy %>% 
  filter(name == "Professor") %>% 
  summarise(total_weight = sum(weight_tons, na.rm = TRUE)) %>% 
  pull(total_weight)

total_number = 
  wheel_tidy %>% 
  filter(name == "Gwynnda", month == "June", year == 2022) %>% 
  summarise(total_number = sum(cigarette_butts)) %>% 
  pull(total_number)
```

There are total 1033 observations in the combined dataset, the key
variables include `date`, `weight_tons`, `volume_cubic_yards`,
`plastic_bottles`, and `wrappers`, ect. The total weight of trash
collected by Professor Trash Wheel is 246.74 tons. There total number of
cigarette butts collected by Gwynda in June of 2022 are 1.812^{4}.

# Problem 3

1.Import and clean the data.

``` r
bakers_df = 
  read_csv("./gbb_datasets/bakers.csv", 
           na = c("NA", "", "."), show_col_types = FALSE) %>% 
  janitor::clean_names() %>% 
  mutate(baker = word(baker_name, 1)) %>% 
  select(-baker_name) 
  
bakes_df = 
  read_csv("./gbb_datasets/bakes.csv",
           na = c("NA", "", "."), show_col_types = FALSE) %>% 
  janitor::clean_names() 

results_df = 
  read_csv("./gbb_datasets/results.csv",
           na = c("NA", "", "."),
           skip = 2, show_col_types = FALSE) %>% 
  janitor::clean_names() 
```

I first use `clean_names` function to clean three data frames, and when
we check the variable names of three data frames, we see there is a
variable called `baker_name` that includes the full name of the
contestants in baker_df instead of `baker`that only includes first name
in other two data frame, which will hinder the merging of three data
frames, so we will use `mutate` function to convert full name to first
name and use `select` remove the full name column.

2.  Anti_join and merge datasets.

``` r
str(bakers_df)
```

    ## tibble [120 × 5] (S3: tbl_df/tbl/data.frame)
    ##  $ series          : num [1:120] 4 10 6 10 7 1 9 4 2 7 ...
    ##  $ baker_age       : num [1:120] 25 28 37 24 25 30 30 31 31 23 ...
    ##  $ baker_occupation: chr [1:120] "Charity worker" "Geography teacher" "Nurse" "Fashion designer" ...
    ##  $ hometown        : chr [1:120] "Saltley, Birmingham" "Essex" "Bracknell, Berkshire" "Halifax" ...
    ##  $ baker           : chr [1:120] "Ali" "Alice" "Alvin" "Amelia" ...

``` r
str(bakes_df)
```

    ## spc_tbl_ [548 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
    ##  $ series        : num [1:548] 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ episode       : num [1:548] 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ baker         : chr [1:548] "Annetha" "David" "Edd" "Jasminder" ...
    ##  $ signature_bake: chr [1:548] "Light Jamaican Black Cakewith Strawberries and Cream" "Chocolate Orange Cake" "Caramel Cinnamon and Banana Cake" "Fresh Mango and Passion Fruit Hummingbird Cake" ...
    ##  $ show_stopper  : chr [1:548] "Red, White & Blue Chocolate Cake with Cigarellos, Fresh Fruit, and Cream" "Black Forest Floor Gateauxwith Moulded Chocolate Leaves, Fallen Fruitand Chocolate Mushrooms Moulded from eggs" "N/A" "N/A" ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   Series = col_double(),
    ##   ..   Episode = col_double(),
    ##   ..   Baker = col_character(),
    ##   ..   `Signature Bake` = col_character(),
    ##   ..   `Show Stopper` = col_character()
    ##   .. )
    ##  - attr(*, "problems")=<externalptr>

``` r
str(results_df)
```

    ## spc_tbl_ [1,136 × 5] (S3: spec_tbl_df/tbl_df/tbl/data.frame)
    ##  $ series   : num [1:1136] 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ episode  : num [1:1136] 1 1 1 1 1 1 1 1 1 1 ...
    ##  $ baker    : chr [1:1136] "Annetha" "David" "Edd" "Jasminder" ...
    ##  $ technical: num [1:1136] 2 3 1 NA 9 NA 8 NA 10 NA ...
    ##  $ result   : chr [1:1136] "IN" "IN" "IN" "IN" ...
    ##  - attr(*, "spec")=
    ##   .. cols(
    ##   ..   series = col_double(),
    ##   ..   episode = col_double(),
    ##   ..   baker = col_character(),
    ##   ..   technical = col_double(),
    ##   ..   result = col_character()
    ##   .. )
    ##  - attr(*, "problems")=<externalptr>

``` r
bakers_results_df = 
  anti_join(results_df, bakers_df, by = c("series", "baker" ))

results_df1 = results_df %>% 
  mutate(
    baker = ifelse(baker == "Joanne", "Jo", baker)) 

check1_df = anti_join(results_df1, bakers_df, by = c("series", "baker" ))

bakers_results = left_join(results_df1, bakers_df, by = c("series", "baker" ))

final_df =
  anti_join(bakes_df, bakers_results, by = c("series", "baker", "episode"))
  
bakes_df =
  bakes_df %>% 
  mutate(
  baker = if_else(baker == '"Jo"', "Jo", baker))

check2_df = 
  anti_join(bakes_df, bakers_results, by = c("series", "baker", "episode"))
  
final <- left_join(bakers_results, bakes_df, by = c("series", "baker", "episode"))

final_obs <- final |> nrow()

write_csv(final, "./gbb_datasets/final.csv")
```

Next, I use `str()` to check the variable types before merging and make
sure variables would be merged are in the same type. `Anti_join` the
bakers_df and results_df first to check missing data and find `Jo` isn’t
in result_df but there is someone called `Joanne`, and they are all in
season2, they might be the same person, so I use mutate function to
replace Joanne with Jo. Then I use `left_join` to merge these two data
frames. `Anti-join` the first merging data frame with bakes_df, Jo’s
name (8 observations) was quoted, so I remove the quote sign and then
`anti_join` again, check there is 0 observation of the new data frame.
Finally, merging the three dataframes which totally include 1136
observations.

``` r
win_table = final %>% 
  filter(result == "STAR BAKER" | result == "WINNER") %>% 
  filter(series %in% c("5", "6", "7", "8", "9", "10")) %>% 
  select(- c(baker_occupation, hometown, signature_bake, show_stopper))
```

I kept `series`, `episode`, `baker`, `result`, `technical` and
`baker_age` in the table. And we can find the winners have very high
technical rank and they usually win the star baker in several episodes
in that season.But surprisingly, David, the winner in season 10 never
won star baker before.

``` r
viewers_df = read_csv("./gbb_datasets/viewers.csv",
                      na = c("NA", "", "."), show_col_types = FALSE) %>% 
  janitor::clean_names() %>% 
  head(10)

mean_s1 =
  viewers_df %>% 
  pull(series_1) %>% 
  mean(na.rm = TRUE)

mean_s5 =
  viewers_df %>% 
  pull(series_5) %>% 
  mean(na.rm = TRUE)
```

The average viewership is 2.77 in Season 1 and 10.0393 in Season 5.
